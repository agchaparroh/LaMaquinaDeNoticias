# Task ID: 20
# Title: Implement POST /procesar_articulo endpoint
# Status: done
# Dependencies: 4, 7, 19
# Priority: high
# Description: Create the API endpoint for processing complete articles in src/main.py.
# Details:
1. In src/main.py, implement the POST /procesar_articulo endpoint
2. Use ArticuloInItem Pydantic model for request validation
3. Call the process_article() function from the controller
4. Implement proper error handling and response formatting
5. Use FastAPI's background tasks for asynchronous processing if required

# Test Strategy:
Create API tests using TestClient. Test with valid and invalid article inputs. Verify correct response formats and error handling.

# Subtasks:
## 20.1. Importar dependencias y configurar endpoint b谩sico [done]
### Dependencies: None
### Description: 
### Details:
- ** Documentos del repositorio**:
  - `/src/main.py` - Buscar la funci贸n `procesar_articulo()` ya esqueletizada
  - `/src/controller.py` - Revisar la firma de `process_article()`
  - `/src/module_connector/src/models.py` - Copiar import path de ArticuloInItem
- ** Documentaci贸n Context7**:
  - Secci贸n 6.1: "Definici贸n de Endpoints FastAPI"
  - Secci贸n 6.2: "Modelos de Request/Response"
- ** Especificaciones de implementaci贸n**:
  - Importar ArticuloInItem desde module_connector
  - Importar el controller ya instanciado (pipeline_controller)
  - Remover el raise NotImplementedError
  - Definir el endpoint con el modelo correcto como par谩metro
  - Agregar documentaci贸n en el docstring

## 20.2. Implementar flujo de procesamiento s铆ncrono [done]
### Dependencies: None
### Description: 
### Details:
- ** Documentos del repositorio**:
  - `/src/controller.py` - M茅todo `process_article()` l铆nea ~200
  - `/src/utils/error_handling.py` - Funci贸n `generate_request_id()`
  - `/src/utils/logging_config.py` - Funci贸n `get_logger()`
- ** Documentaci贸n Context7**:
  - Secci贸n 7.1: "Flujo de Procesamiento de Art铆culos"
  - Secci贸n 7.2: "Contratos de Datos entre M贸dulos"
- ** Especificaciones de implementaci贸n**:
  - Generar request_id 煤nico para el procesamiento
  - Crear logger con contexto del request_id
  - Convertir ArticuloInItem a diccionario para el controller
  - Llamar await process_article() del controller
  - Retornar el resultado directamente

## 20.3. Agregar validaci贸n y preparaci贸n de datos [done]
### Dependencies: None
### Description: 
### Details:
- ** Documentos del repositorio**:
  - `/src/module_connector/src/models.py` - M茅todo `validate_required_fields()`
  - `/src/models/entrada.py` - Validadores de FragmentoProcesableItem
  - `/docs/07-manejo-de-errores.md` - Secci贸n de validaci贸n de entrada
- ** Documentaci贸n Context7**:
  - Secci贸n 6.3: "Validaci贸n de Datos de Entrada"
  - Secci贸n 11.1: "Validaci贸n en FastAPI"
- ** Especificaciones de implementaci贸n**:
  - Verificar campos requeridos del art铆culo
  - Preparar campos faltantes con valores por defecto
  - Validar longitud m铆nima del contenido_texto
  - Registrar en logs los datos recibidos (sin contenido completo)
  - Lanzar HTTPException 400 si faltan datos cr铆ticos

## 20.4. Implementar respuesta estructurada y manejo de errores [done]
### Dependencies: None
### Description: 
### Details:
- ** Documentos del repositorio**:
  - `/src/main.py` - Manejadores de excepciones ya configurados
  - `/src/utils/error_handling.py` - Funci贸n `create_error_response()`
  - `/docs/07-manejo-de-errores.md` - Formatos de respuesta de error
- ** Documentaci贸n Context7**:
  - Secci贸n 11.2: "Manejo de Errores en Pipeline"
  - Secci贸n 11.3: "Respuestas HTTP Estructuradas"
- ** Especificaciones de implementaci贸n**:
  - Envolver la llamada al controller en try/except
  - Capturar PipelineException y dejar que el handler global la maneje
  - Para errores de validaci贸n, usar ValidationError personalizada
  - Estructurar respuesta exitosa con campos est谩ndar
  - Incluir siempre request_id en la respuesta
  - Agregar timestamp y versi贸n del API

## 20.5. Optimizar para art铆culos largos (opcional background) [done]
### Dependencies: None
### Description: 
### Details:
- ** Documentos del repositorio**:
  - `/src/main.py` - Importar BackgroundTasks de FastAPI
  - `/src/controller.py` - M茅tricas de tiempo de procesamiento
  - `/docs/arquitectura_general.md` - Consideraciones de performance
- ** Documentaci贸n Context7**:
  - Secci贸n 8.1: "Procesamiento As铆ncrono en FastAPI"
  - Secci贸n 8.2: "Background Tasks vs Workers"
- ** Especificaciones de implementaci贸n**:
  - Medir longitud del contenido_texto
  - Si supera 10,000 caracteres, considerar background task
  - Por ahora, mantener s铆ncrono pero agregar comentario TODO
  - Documentar el threshold en el c贸digo
  - Preparar estructura para futura implementaci贸n as铆ncrona

## 20.6. Test de Verificaci贸n Simple [done]
### Dependencies: None
### Description: 
### Details:
- ** Documentos del repositorio**:
  - `/tests/test_api/` - Crear test_procesar_articulo.py aqu铆
  - `/tests/conftest.py` - Fixtures compartidas de pytest
  - `/src/module_connector/src/models.py` - Ejemplo de ArticuloInItem
- ** Documentaci贸n Context7**:
  - Secci贸n 13.3: "Testing de Endpoints con TestClient"
  - Secci贸n 13.4: "Fixtures para Testing de API"
- ** Especificaciones de implementaci贸n**:
  - Crear test con FastAPI TestClient
  - Test con art铆culo v谩lido completo
  - Test con art铆culo sin campos requeridos
  - Test con contenido vac铆o
  - Verificar estructura de respuesta exitosa
  - Verificar c贸digos de estado HTTP correctos
  - Ejecutable con: pytest tests/test_api/test_procesar_articulo.py -v

